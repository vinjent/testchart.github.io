<!DOCTYPE html>
<html lang="en">
	<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
	<meta name="description" content="">
	<meta name="author" content="CraftingGamerTom">

	<title>EasyAPI-Chi bootstrap table</title>
	<!--<link href="https://www.jqueryscript.net/css/jquerysctipttop.css" rel="stylesheet" type="text/css">-->
	<!-- Bootstrap core CSS-->
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/4.3.1/flatly/bootstrap.min.css">
	<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
	<!-- Font Awesome -->
	<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.8.1/css/all.css" integrity="sha384-50oBUHEmvpQ+1lW4y57PTFmhCaXp0ML5d60M1M7uH2+nqUivzIebhndOJK28anvf" crossorigin="anonymous">
	<!-- JQuery library -->
	<script src="https://code.jquery.com/jquery-3.4.1.min.js" integrity="sha384-vk5WoKIaW/vJyUAd9n/wmopsmNhiy+L2Z+SBxGYnUkunIxVxAv/UtMOhba/xskxh" crossorigin="anonymous"></script>	
	<!--<script src="http://code.jquery.com/jquery-3.3.1.js" type="text/javascript"></script>-->
	<script src="https://cdn.amcharts.com/lib/5/index.js"></script>
	<script src="https://cdn.amcharts.com/lib/5/percent.js"></script>
	<script src="https://cdn.amcharts.com/lib/5/themes/Animated.js"></script>
	<style>
		body {
		  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol";
		  background-color: #f5fffa;
		}

		#chartdiv {
		  align: "center"
		  width: 100%;
		  height: 900px;
		  min-width: 400px; 
		  min-height: 200px;
		  margin: auto; 
		}
	</style>
</head>

<body>	
	<select id='date' style="width: 150px;">
		<option>選擇日期...</option>
	</select>
	<select id='stock' style="width: 150px;">
		<option>選擇個股...</option>
	</select>
	<select id='type' style="width: 150px;">
		<option>選擇買賣超...</option>
		<!--<option value='買超'>買超</option>
		<option value='賣超'>賣超</option> -->
	</select>
	<div id="chartdiv"></div>
	<script type="text/javascript">	
	/**
	 * ---------------------------------------
	 * This demo was created using amCharts 5.
	 * 
	 * For more information visit:
	 * https://www.amcharts.com/
	 * 
	 * Documentation is available at:
	 * https://www.amcharts.com/docs/v5/
	 * ---------------------------------------
	 */

	// Create root element
	// https://www.amcharts.com/docs/v5/getting-started/#Root_element
	var root = am5.Root.new("chartdiv");


	// Set themes
	// https://www.amcharts.com/docs/v5/concepts/themes/
	root.setThemes([
	  am5themes_Animated.new(root)
	]);


	// Create chart
	// https://www.amcharts.com/docs/v5/charts/percent-charts/pie-chart/
	var chart = root.container.children.push(am5percent.PieChart.new(root, {
	  layout: root.horizontalLayout,//verticalLayout,
	  radius: am5.percent(80),	  
	  autoMargins: true
	}));


	// Create series
	// https://www.amcharts.com/docs/v5/charts/percent-charts/pie-chart/#Series
	var series = chart.series.push(am5percent.PieSeries.new(root, {
	  valueField: "超額",
	  categoryField: "名稱",
	  legendLabelText: "[{fill}]{category}[/]",
	  legendValueText: "[bold {fill}]{value}[/]",
	  tooltip: am5.Tooltip.new(root, {labelText: "--{category}--\n超額: {value}\n均價: {均價}"})
	}));
	
	//Create legend
	
	var legend = chart.children.push(am5.Legend.new(root, {
	  centerX: am5.percent(90),
	  x: am5.percent(90),
	  centerY: am5.percent(10),
	  y: am5.percent(10),
	  //marginTop: 15,
	  //marginBottom: 15,
	  layout: root.verticalLayout
	}));
	
	function reSetData()
	{	
		var filePath=dateStr+"\\"+stockStr+"\\"+typeStr+".json";			
		var data=[];
		$.ajax({
			type: 'get',				
			url: 'http://qtest.ddns.net/api/Data?filePath=' + filePath,
			success: function (json) {					
				$.each(JSON.parse(json), function(index, value){
					if (typeStr === "賣超")
					{
						data.push({
							"名稱": value.名稱,
							"超額": value.賣超,
							"均價": value.均價							
						});
					}
					if (typeStr === "買超")
					{
						data.push({
							"名稱": value.名稱,
							"超額": value.買超,
							"均價": value.均價
						});
					}
				});					
				series.data.setAll(data);
				legend.data.setAll(series.dataItems);
			},
			error: function (err) {
				alert(err.message);
			}
		}); 
	}
		
	// Play initial series animation
	// https://www.amcharts.com/docs/v5/concepts/animations/#Animation_of_series
	series.appear(1000, 100);
	</script>
	
	<script>	
		var dateStr;
		var stockStr;
		var typeStr;
		$(document).ready(function() {	
			$.ajax({
				type: 'get',				
				url: 'http://qtest.ddns.net/api/Date',
                success: function (data) {					
                    $.each(data, function(index, value) {
						$("#date").append($("<option></option>").val(value).html(value));						
					});
				},
				error: function (err) {
					alert(err.message);
				}
			});               
		});
		
		$("#date").change(function () {
			$("#stock").empty().append($("<option></option>").val('選擇個股...').html('選擇個股...'));
			$("#date option:selected").each(function () {
				dateStr = $(this).text();
				$.ajax({
					type: 'get',				
					url: 'http://qtest.ddns.net/api/Stocks?date=' + dateStr,
					success: function (data) {					
						$.each(data, function(index, value) {
							$("#stock").append($("<option></option>").val(value).html(value));						
						});
					},
					error: function (err) {
						alert(err.message);
					}
				});  
			});
		});
		
		$("#stock").change(function () {
			$("#type").empty().append($("<option></option>").val('選擇買賣超...').html('選擇買賣超...'));
			$("#stock option:selected").each(function () {
				stockStr=$(this).text();
				dataArray = ['買超','賣超'];				
                $.each(dataArray, function(index, value) {
					$("#type").append($("<option></option>").val(value).html(value));						
				});				
			});  
		});
		
		$("#type").change(function () {
			$("#type option:selected").each(function () {
				typeStr=$(this).text();
				reSetData();
			});			
		});
	</script>
</body>
</html>

